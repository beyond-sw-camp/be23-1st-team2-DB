


 
<img width="512" height="512" alt="Image" src="https://github.com/user-attachments/assets/5b830226-ca50-4fd1-baa7-1692557ae018" />
 

  âš½ í’‹ì‚´ ë§¤ì¹­ DB í”„ë¡œì íŠ¸ â€“ MeetBall

**íŒ€ëª…: FutFut**

**íŒ€ì›**
í™©ê±´í•˜, ì´ìˆ˜ë¦¼, ë°•ì¤€í˜•, ì •ë¯¼ì •

## ìŠ¤íƒ
<p>
<img src="https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=git&logoColor=white">  
<img src="https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=github&logoColor=white">  
<img src="https://img.shields.io/badge/MariaDB-003545?style=for-the-badge&logo=mariadb&logoColor=white">  
<img src="https://img.shields.io/badge/VS%20Code-007ACC?style=for-the-badge&logo=visual-studio-code&logoColor=white">  
<img src="https://img.shields.io/badge/Discord-5865F2?style=for-the-badge&logo=discord&logoColor=white">




</p>


### ğŸ’¡ í”„ë¡œì íŠ¸ ê°œìš”

![Image](https://github.com/user-attachments/assets/b6a3194e-fd45-4485-a676-d93afa98ec1c)

ë³µì¡í•œ í’‹ì‚´ ê²½ê¸° ë§¤ì¹­ + ì˜ˆì•½ + ì •ì‚° + íˆìŠ¤í† ë¦¬ ê´€ë¦¬ë¥¼ DB ì¤‘ì‹¬ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ëœ í”Œë«í¼ì…ë‹ˆë‹¤.  
ì‚¬ìš©ì(íšŒì›)ëŠ” íŒ€ ì—†ì´ë„ ê²½ê¸°ì— ì‹ ì²­/ì°¸ì—¬í•  ìˆ˜ ìˆê³ ,  
ê´€ë¦¬ìëŠ” ê²½ê¸° ìƒì„±, ë§¤ì¹­, ì •ì‚° ê´€ë¦¬ë¥¼ í•  ìˆ˜ ìˆì–´ìš”.  
ë°ì´í„°ë² ì´ìŠ¤ + SQL + ìë™í™” ë¡œì§ ê¸°ë°˜ìœ¼ë¡œ,  
â€œëˆ„êµ¬ë‚˜ ì‰½ê²Œ, ê³µì •í•˜ê²Œ, íˆ¬ëª…í•˜ê²Œâ€ í’‹ì‚´ ê²½ê¸°ë¥¼ ì¦ê¸¸ ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ë§Œë“œëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.


### âœ¨ ì£¼ìš” ê¸°ëŠ¥

1. íšŒì›: ê²½ê¸° ì‹ ì²­, ê²°ì œ, ì·¨ì†Œ/í™˜ë¶ˆ, POM íˆ¬í‘œ  
2. ì‹¬íŒ/ë§¤ì¹­: ê²½ê¸° ìƒì„±, ì‹ ì²­ ì¸ì› ì²´í¬ â†’ ë§¤ì¹­ ë˜ëŠ” í™˜ë¶ˆ  
3. ê²°ì œ / í™˜ë¶ˆ / ì •ì‚°  
4. ì¡°íšŒ / ë‚´ì—­ ì¡°íšŒ ê¸°ëŠ¥ (ê²½ê¸° ëª©ë¡, ì‹ ì²­ ë‚´ì—­, ê²°ì œ/í™˜ë¶ˆ ë‚´ì—­, êµ¬ì¥ ìƒì„¸, íˆìŠ¤í† ë¦¬)  

---

## ğŸ—“ï¸ WBS


<img width="527" height="658" alt="Image" src="https://github.com/user-attachments/assets/8b4a3910-22db-4988-8472-34fe525e6707" />

https://docs.google.com/spreadsheets/d/1fIUSy4qkfBQxXwY54RJ-XUnWjjOReSNoq1BAZvF45AA/edit?gid=827308645#gid=827308645


---
## ğŸ“ ìš”êµ¬ì‚¬í•­ì •ì˜ì„œ


<img width="461" height="525" alt="Image" src="https://github.com/user-attachments/assets/96074871-bc80-424e-a767-4d24a159b762" />

https://docs.google.com/spreadsheets/d/1JPzOK-3ZNih2dvhaKj_woaxKXlj8aVoJJ0jWgI7P8M4/edit?gid=683578131#gid=683578131

---

## ğŸ” 4. DB ëª¨ë¸ë§
<img width="2010" height="1272" alt="Image" src="https://github.com/user-attachments/assets/e932899f-fdaf-42c5-84eb-a7739271be12" />
https://www.erdcloud.com/d/xgt9LzrHYkuyy4dbG

---

## 5. SQL

### 5-1. DDL (ë°ì´í„° ì •ì˜ì–´)

<details>
  <summary>-- 1. ì‚¬ìš©ì(ì‹¬íŒ, íšŒì›)</summary>

ì‚¬ìš©ì í…Œì´ë¸”ì€ ì‹¬íŒê³¼ íšŒì› í…Œì´ë¸”ì˜ ë¶€ëª¨í…Œì´ë¸”ë¡œ ë¡œê·¸ì¸ì„ í•˜ê¸° ìœ„í•œ ì •ë³´ë“¤ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
íšŒì›ì€ ì¶•êµ¬ ë§¤ì¹­ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.
ì‹¬íŒì€ ì¶•êµ¬ ë§¤ì¹­ì„ ë§Œë“¤ê³  ì‹¬íŒìœ¼ë¡œ ì°¸ì—¬í•©ë‹ˆë‹¤.

- user: ë¡œê·¸ì¸ì„ ìœ„í•œ ì •ë³´ë“¤ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
- member: ê³„ì¢Œë²ˆí˜¸ì™€ pom ì„ ì •ëœ íšŸìˆ˜ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
- referee: ì‹¬íŒ ìê²©ì¦, ìˆ˜ìˆ˜ë£Œ, ê³„ì¢Œë²ˆí˜¸ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. 

```sql
    CREATE TABLE user (
    ID bigint NOT NULL AUTO_INCREMENT,
    name varchar(255) NOT NULL,
    email varchar(255) NOT NULL UNIQUE,
    login_id varchar(255) NOT NULL UNIQUE,
    password varchar(255) NOT NULL,
    phone_number varchar(255) NOT NULL,
    status ENUM('Y', 'N') NOT NULL DEFAULT 'N',
    PRIMARY KEY (ID)
) COMMENT='ì‚¬ìš©ì';
```

```sql
CREATE TABLE member (
    ID bigint NOT NULL AUTO_INCREMENT,
    userID bigint NOT NULL,
    account varchar(255) NOT NULL,
    pomCount int NOT NULL DEFAULT 0,
    PRIMARY KEY (ID),
    FOREIGN KEY (userID) REFERENCES user (ID)
) COMMENT='íšŒì›';
```

```sql
CREATE TABLE referee (
    ID bigint NOT NULL AUTO_INCREMENT,
    userID bigint NOT NULL,
    certificate varchar(255) NOT NULL ,
    pay_account varchar(255) NOT NULL,
    fee_rate int NOT NULL DEFAULT 3,
    PRIMARY KEY (ID),
    FOREIGN KEY (userID) REFERENCES user (ID)
) COMMENT='ì‹¬íŒ';
```
</details>

<details>
  <summary>-- 2. ì‹¬íŒ</summary>

ì‹¬íŒì€ êµ¬ì¥ê³¼ ì‹œê°„ì„ ì •í•´ì„œ ê²½ê¸°ë¥¼ ì£¼ì„ í•©ë‹ˆë‹¤.
ê²½ê¸°ê°€ ì„±ì‚¬ëœ í›„ì—ëŠ” ì •ì‚°ê¸ˆì„ ë°›ìŠµë‹ˆë‹¤.

- referee_payment: ì‹¬íŒ ì •ì‚° ê¸ˆì•¡ì„ ì¡°íšŒí•˜ê¸° ìœ„í•œ í…Œì´ë¸”ì…ë‹ˆë‹¤.
- match: ì‹¬íŒì— ì˜í•´ êµ¬ì¥ê³¼ ì‹œê°„ëŒ€ê°€ ì„ íƒë˜ì–´ ê²½ê¸°ê°€ ì—´ë¦½ë‹ˆë‹¤.
'ê³„íš', 'ì—´ë¦¼', 'ë‹«í˜', 'ì·¨ì†Œ' ìƒíƒœë¡œ ë³€í•  ìˆ˜ ìˆê³ ,
ì²˜ìŒì€ 'ê³„íš'ìƒíƒœì…ë‹ˆë‹¤.

```sql
    CREATE TABLE referee_payment (
    ID bigint NOT NULL AUTO_INCREMENT,
    refereeID bigint NOT NULL,
    paymentDate datetime NOT NULL ,
    payment int NOT NULL,
    PRIMARY KEY (ID),
    FOREIGN KEY (refereeID) REFERENCES referee (ID)
) COMMENT='ì‹¬íŒ ì •ì‚° ë‚´ì—­';
```

```sql
CREATE TABLE matches (
    ID bigint NOT NULL AUTO_INCREMENT,
    stadiumID bigint NOT NULL,
    refereeID bigint NOT NULL,
    match_price int NOT NULL,
    date date NOT NULL,
    time time NOT NULL,
    member_count int NOT NULL,
    POM varchar(255),
    status ENUM('ê³„íš', 'ì—´ë¦¼', 'ë‹«í˜', 'ì·¨ì†Œ') NOT NULL DEFAULT 'ê³„íš',
    PRIMARY KEY (ID),
    FOREIGN KEY (stadiumID) REFERENCES stadium (ID),
    FOREIGN KEY (refereeID) REFERENCES referee (ID)
) COMMENT='ê²½ê¸°';
```

</details>

<details>
  <summary>-- 3. íšŒì›</summary>

íšŒì›ì€ ê³„íšëœ ê²½ê¸°ì— ì‹ ì²­í•˜ë©°, ê²°ì œë¥¼ í•˜ê³ , ê²½ê¸°ê°€ ì„±ì‚¬ë˜ë©´ í•´ë‹¹ ê²½ê¸°ì˜ pomì„ ì„ ì •í•©ë‹ˆë‹¤. ë§Œì•½ ì¸ì›ì´ ëª¨ì´ì§€ ì•Šì•„ ê²½ê¸°ê°€ ì·¨ì†Œë  ê²½ìš° í™˜ë¶ˆì„ ë°›ìŠµë‹ˆë‹¤.

- match_apply: íšŒì›ê³¼ ì°¸ì—¬í•˜ëŠ” ê²½ê¸°ê°€ ê¸°ë¡ë˜ê³ , 'ìŠ¹ì¸', 'ëŒ€ê¸°', 'í™˜ë¶ˆ' ìƒíƒœë¡œ ë³€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹ ì²­ì„ í•˜ë©´ ê²°ì œê°€ ì´ë£¨ì–´ì§€ë©°, ê²°ì œ ë‚ ì§œê°€ ê¸°ë¡ë˜ê³ , 'ëŒ€ê¸°'ìƒíƒœê°€ ë©ë‹ˆë‹¤. ìµœì†Œì¸ì›ì„ ì¶©ì¡±í•˜ë©´ 'ìŠ¹ì¸'ìƒíƒœë¡œ ë³€ê²½ë˜ê³  ì¸ì›ì´ ëª¨ì´ì§€ ì•Šìœ¼ë©´ 'í™˜ë¶ˆ'ìƒíƒœê°€ ë©ë‹ˆë‹¤. 
- pom_vote: ê²½ê¸°ê°€ ëë‚œ í›„ ê° íšŒì›ì´ pomì„ íˆ¬í‘œí•œ ê¸°ë¡ì´ ì €ì¥ë©ë‹ˆë‹¤.

```sql
CREATE TABLE match_apply (
    ID bigint NOT NULL AUTO_INCREMENT,
    memberID bigint NOT NULL,
    matchesID bigint NOT NULL,
    status ENUM('ìŠ¹ì¸', 'ëŒ€ê¸°', 'í™˜ë¶ˆ') NOT NULL DEFAULT 'ëŒ€ê¸°',
    apply_price int NOT NULL DEFAULT 10000,
    payment_time datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
    refund_time datetime NULL,

    PRIMARY KEY (ID),
    FOREIGN KEY (memberID) REFERENCES member (ID),
    FOREIGN KEY (matchesID) REFERENCES matches (ID)
) COMMENT='ê²½ê¸° ì‹ ì²­';
```

```sql
CREATE TABLE pom_vote (
    ID bigint NOT NULL AUTO_INCREMENT,
    applyID bigint NOT NULL,
    voter_memberID bigint NOT NULL,
    voted_memberID bigint NULL,

    PRIMARY KEY (ID),
    FOREIGN KEY (applyID) REFERENCES match_apply (ID),
    FOREIGN KEY (voter_memberID) REFERENCES member (ID),
    FOREIGN KEY (voted_memberID) REFERENCES member (ID)
) COMMENT='íˆ¬í‘œ';
```

</details>

<details>
  <summary>-- 4. êµ¬ì¥</summary>

êµ¬ì¥ì€ êµ¬ì¥, êµ¬ì¥ ì˜µì…˜, êµ¬ì¥ ì˜µì…˜ë³„ ìƒì„¸ í…Œì´ë¸”ì´ ì¡´ì¬í•©ë‹ˆë‹¤.
êµ¬ì¥ì´ ì˜µì…˜ì„ ë™ì ìœ¼ë¡œ ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•˜ì—¬, ê° êµ¬ì¥ë§ˆë‹¤ ë‹¤ì–‘í•œ ì˜µì…˜ì´ ì¡´ì¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- stadium: êµ¬ì¥ì˜ ì´ë¦„, ìœ„ì¹˜, ìµœëŒ€ ìˆ˜ìš©ì¸ì›, êµ¬ì¥ì˜ ìƒí…Œë©”ì‹œì§€ê°€ ì €ì¥ë©ë‹ˆë‹¤.
- stadium_option: ìƒ¤ì›Œì‹¤, í¡ì—°ì‹¤, ìœ ë£Œì£¼ì°¨ ë“±ì˜ ì˜µì…˜ëª…ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- stadium_detail_option: êµ¬ì¥ê³¼ êµ¬ì¥ ì˜µì…˜ì„ ê°€ì ¸ì™€ì„œ, ê° êµ¬ì¥ì˜ ì˜µì…˜ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```sql
CREATE TABLE stadium (
    ID bigint NOT NULL AUTO_INCREMENT,
    name varchar(255) NOT NULL,
    condition_text text,
    location varchar(255),
    max_count int NOT NULL,
    PRIMARY KEY (ID)
) COMMENT='êµ¬ì¥';
```

```sql
CREATE TABLE stadium_option (
    ID bigint NOT NULL AUTO_INCREMENT,
    name varchar(255) NOT NULL,
    PRIMARY KEY (ID)
) COMMENT='êµ¬ì¥ ì˜µì…˜';
```

```sql
CREATE TABLE stadium_detail_option (
    ID bigint NOT NULL AUTO_INCREMENT,
    stadiumID bigint NOT NULL,
    optionID bigint NOT NULL,

    PRIMARY KEY (ID),
    UNIQUE KEY UQ_stadium_option (stadiumID, optionID),
    FOREIGN KEY (stadiumID) REFERENCES stadium (ID),
    FOREIGN KEY (optionID) REFERENCES stadium_option (ID)
) COMMENT='êµ¬ì¥ ìƒì„¸';
```
</details>

</div>
</details>

<hr/>

#### ì£¼ìš” ê¸°ëŠ¥ í”„ë¡œì‹œì €

<details>
<summary><b>íšŒì›</b></summary>
```sql
// íšŒì› ë“±ë¡

DROP PROCEDURE IF EXISTS íšŒì›ë“±ë¡;
DELIMITER //
create
    definer = root@localhost procedure íšŒì›ë“±ë¡(IN p_name varchar(255), IN p_email varchar(255), IN p_login_id varchar(255),
                                            IN p_password varchar(255), IN p_phone varchar(255),
                                            IN p_account varchar(255))
BEGIN
    START TRANSACTION;

    INSERT INTO user (
        name,
        email,
        login_id,
        password,
        phone_number,
        status
    ) VALUES (
                 p_name,
                 p_email,
                 p_login_id,
                 p_password,
                 p_phone,
                 'n'
             );

    INSERT INTO member (
        userID,
        account,
        pomCount
    ) VALUES (
                 LAST_INSERT_ID(),
                 p_account,
                 0
             );

    COMMIT;
END;

DELIMITER ;

```
</details>

</div>
</details>

<details>


<details>
<summary><b>ì‹¬íŒ</b></summary>

```sql
// ì‹¬íŒ ë“±ë¡


DROP PROCEDURE IF EXISTS ì‹¬íŒë“±ë¡;
DELIMITER //
create
    definer = root@localhost procedure ì‹¬íŒë“±ë¡(IN p_name varchar(255), IN p_email varchar(255), IN p_login_id varchar(255),
                                            IN p_password varchar(255), IN p_phone varchar(255),
                                            IN p_certificate varchar(255), IN p_pay_account varchar(255),
                                            IN p_fee_rate int)
BEGIN
    START TRANSACTION;

    INSERT INTO user (
        name,
        email,
        login_id,
        password,
        phone_number,
        status
    ) VALUES (
                 p_name,
                 p_email,
                 p_login_id,
                 p_password,
                 p_phone,
                 'n'
             );

    INSERT INTO referee (
        userID,
        certificate,
        pay_account,
        fee_rate
    ) VALUES (
                 LAST_INSERT_ID(),
                 p_certificate,
                 p_pay_account,
                 p_fee_rate
             );

    COMMIT;
END;

DELIMITER ;

```

```sql
// ê²½ê¸° open


DROP PROCEDURE IF EXISTS ê²½ê¸°ì˜¤í”ˆ;

DELIMITER //
create
    definer = root@localhost procedure ê²½ê¸°ì˜¤í”ˆ(IN p_referee_id bigint, IN p_stadium_id bigint, IN p_match_price int,
                                            IN p_date date, IN p_time time, IN p_member_count int,
                                            IN p_pom varchar(255))
BEGIN
    DECLARE v_count INT DEFAULT 0;

    -- ì‹¬íŒ ì¡´ì¬ í™•ì¸
    SELECT COUNT(*) INTO v_count
    FROM referee
    WHERE id = p_referee_id;

    IF v_count = 0 THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‹¬íŒì…ë‹ˆë‹¤.';
    END IF;

    -- êµ¬ì¥ ì¡´ì¬ í™•ì¸
    SELECT COUNT(*) INTO v_count
    FROM stadium
    WHERE id = p_stadium_id;

    IF v_count = 0 THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” êµ¬ì¥ì…ë‹ˆë‹¤.';
    END IF;

    -- ê°™ì€ ë‚ ì§œÂ·ì‹œê°„ëŒ€ ì¤‘ë³µ ê²½ê¸° í™•ì¸
    SELECT COUNT(*) INTO v_count
    FROM matches
    WHERE refereeID = p_referee_id
      AND date = p_date
      AND time = p_time;

    IF v_count > 0 THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'í•´ë‹¹ ì‹¬íŒì€ ì´ë¯¸ ê°™ì€ ì‹œê°„ëŒ€ ê²½ê¸°ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.';
    END IF;

    -- ì‹ ê·œ ê²½ê¸° ìƒì„±
    INSERT INTO matches(
        stadiumID, refereeID, match_price,
        date, time, member_count, POM, status
    ) VALUES (
                 p_stadium_id, p_referee_id, p_match_price,
                 p_date, p_time, p_member_count, p_pom, 'ì—´ë¦¼'
             );

    -- ìƒì„±ëœ match ID ë°˜í™˜
    SELECT LAST_INSERT_ID() AS match_id;

END;

DELIMITER ;

```

```sql
// ì‹¬íŒê¸‰ì—¬ ì •ì‚°

DELIMITER //

CREATE PROCEDURE ì‹¬íŒì •ì‚°ì…ë ¥(IN rID BIGINT)
BEGIN
    DECLARE fee INT;
    DECLARE calcPayment INT;

    -- ì‹¬íŒ ìˆ˜ìˆ˜ë£Œìœ¨ ì¡°íšŒ
    SELECT fee_rate INTO fee
    FROM referee
    WHERE ID = rID;

    -- ê³ ì •ê¸ˆì•¡ 20000ì›ì—ì„œ ìˆ˜ìˆ˜ë£Œ ê³„ì‚°
    -- ìˆ˜ìˆ˜ë£Œë§Œí¼ ì œì™¸: payment = 20000 * (100 - fee_rate) / 100
    SET calcPayment = ROUND(20000 * (100 - fee) / 100);

    -- ì •ì‚° í…Œì´ë¸”ì— ì €ì¥
    INSERT INTO referee_payment (refereeID, paymentDate, payment)
    VALUES (rID, CURRENT_TIMESTAMP, calcPayment);
END //

DELIMITER ;

```
</details>

</div>
</details>


<details>
<summary><b>êµ¬ì¥</b></summary>

```sql
--êµ¬ì¥ë“±ë¡


DROP PROCEDURE IF EXISTS êµ¬ì¥ë“±ë¡;
DELIMITER //

CREATE PROCEDURE êµ¬ì¥ë“±ë¡(
    IN p_name VARCHAR(255),
    IN p_location VARCHAR(255),
    IN p_condition TEXT,
    IN p_max_count INT
)
BEGIN
    DECLARE v_count INT DEFAULT 0;

    -- ì¤‘ë³µ êµ¬ì¥ëª… í™•ì¸
    SELECT COUNT(*) INTO v_count
    FROM stadium
    WHERE name = p_name;

    IF v_count > 0 THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ì´ë¯¸ ì¡´ì¬í•˜ëŠ” êµ¬ì¥ ì´ë¦„ì…ë‹ˆë‹¤.';
    END IF;

    -- ì‹ ê·œ êµ¬ì¥ ìƒì„±
    INSERT INTO stadium(name, location, condition_text, max_count)
    VALUES (p_name, p_location, p_condition, p_max_count);

    -- ìƒì„±ëœ stadium ID ë°˜í™˜
    SELECT LAST_INSERT_ID() AS stadium_id;

END //

DELIMITER ;

```
</details>

</div>
</details>


<details>
<summary><b>ê²½ê¸°</b></summary>

```sql
// ê²½ê¸°ì‹ ì²­

DELIMITER //

CREATE PROCEDURE ê²½ê¸°ì‹ ì²­(
    IN p_member_id BIGINT,
    IN p_matches_id BIGINT
)
BEGIN
    DECLARE v_current_count INT DEFAULT 0;
    DECLARE v_max_count INT DEFAULT 0;
    DECLARE v_match_price INT;

    -- ê²½ê¸° ì¡´ì¬ ì—¬ë¶€ í™•ì¸ ë° ìµœëŒ€ ì¸ì›, ê°€ê²© ê°€ì ¸ì˜¤ê¸°
    SELECT max_count, match_price
    INTO v_max_count, v_match_price
    FROM matches
    WHERE id = p_matches_id;

    IF v_max_count IS NULL THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ê¸°ì…ë‹ˆë‹¤.';
    END IF;

    -- ì´ë¯¸ ì‹ ì²­í–ˆëŠ”ì§€ í™•ì¸
    SELECT COUNT(*) INTO v_current_count
    FROM match_apply
    WHERE matchesID = p_matches_id
      AND memberID = p_member_id
      AND refund_time IS NULL;

    IF v_current_count > 0 THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ì´ë¯¸ ì‹ ì²­í•œ ê²½ê¸°ì…ë‹ˆë‹¤.';
    END IF;

    -- í˜„ì¬ ì‹ ì²­ ì¸ì› í™•ì¸
    SELECT COUNT(*) INTO v_current_count
    FROM match_apply
    WHERE matchesID = p_matches_id
      AND refund_time IS NULL;

    -- ìµœëŒ€ ì¸ì› ì²´í¬
    IF v_current_count >= v_max_count THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ì´ë¯¸ ìµœëŒ€ ì¸ì›ìœ¼ë¡œ ì‹ ì²­ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.';
    END IF;

    -- ì‹ ì²­ ì§„í–‰
    INSERT INTO match_apply(matchesID, memberID, apply_price, status)
    VALUES(p_matches_id, p_member_id, v_match_price, 'ì‹ ì²­');

    SELECT 'ì‹ ì²­ ì™„ë£Œ' AS result;

END //

DELIMITER ;

```sql
// ê²½ê¸°ì‹ ì²­ ë¶ˆê°€


DELIMITER //

CREATE PROCEDURE ê²½ê¸°ì‹ ì²­ë¶ˆê°€(
    IN p_member_id BIGINT,
    IN p_matches_id BIGINT
)
BEGIN
    DECLARE v_current_count INT DEFAULT 0;
    DECLARE v_max_count INT DEFAULT 0;

    -- ê²½ê¸° ì¡´ì¬ ì—¬ë¶€ í™•ì¸ ë° ìµœëŒ€ ì¸ì› ê°€ì ¸ì˜¤ê¸°
    SELECT max_count
    INTO v_max_count
    FROM matches
    WHERE id = p_matches_id;

    IF v_max_count IS NULL THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ê¸°ì…ë‹ˆë‹¤.';
    END IF;

    -- í˜„ì¬ ì‹ ì²­ ì¸ì› í™•ì¸ (í™˜ë¶ˆëœ ì¸ì› ì œì™¸)
    SELECT COUNT(*) INTO v_current_count
    FROM match_apply
    WHERE matchesID = p_matches_id
      AND refund_time IS NULL;

    -- ìµœëŒ€ ì¸ì› ì´ˆê³¼ ì‹œ ì‹ ì²­ ë¶ˆê°€
    IF v_current_count >= v_max_count THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ì´ë¯¸ ìµœëŒ€ ì¸ì›ìœ¼ë¡œ ì‹ ì²­ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.';
    END IF;

    SELECT 'ì‹ ì²­ ê°€ëŠ¥' AS result;

END //

DELIMITER ;
```
</details>

</div>
</details>

<details>
<summary><b>ë§¤ì¹­</b></summary>
	
```sql
// ë§¤ì¹˜ ì„±ê³µ, ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤

DELIMITER //

CREATE PROCEDURE ë§¤ì¹˜ì‹œë‚˜ë¦¬ì˜¤(
    IN p_match_id BIGINT
)
BEGIN
    DECLARE v_apply_count INT DEFAULT 0;
    DECLARE v_match_datetime DATETIME;
    DECLARE v_current DATETIME;

    -- í˜„ì¬ ì‹œê°„
    SET v_current = NOW();

    -- ê²½ê¸° ë‚ ì§œ + ì‹œê°„ í•©ì³ì„œ DATETIME ìƒì„±
    SELECT TIMESTAMP(`date`, `time`)
    INTO v_match_datetime
    FROM matches
    WHERE id = p_match_id;

    -- ê²½ê¸° ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    IF v_match_datetime IS NULL THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ê¸°ì…ë‹ˆë‹¤.';
    END IF;

    -- 1ì‹œê°„ ì „ ì²´í¬
    IF v_match_datetime <= DATE_ADD(v_current, INTERVAL 1 HOUR) THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ì´ë¯¸ ê²½ê¸° ì‹œì‘ 1ì‹œê°„ ì „ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤.';
    END IF;

    -- match_apply í…Œì´ë¸”ì—ì„œ ì‹ ì²­ ì¸ì› ìˆ˜ í™•ì¸
    SELECT COUNT(*) INTO v_apply_count
    FROM match_apply
    WHERE matchesID = p_match_id;

    -- ìµœì†Œ ì¸ì› 10ëª… ì´ìƒ â†’ ë§¤ì¹­ ì„±ê³µ
    IF v_apply_count >= 10 THEN

        -- ìƒíƒœ ì—…ë°ì´íŠ¸
        UPDATE matches
        SET status = 'ë§¤ì¹­ ìŠ¹ì¸'
        WHERE id = p_match_id
          AND status = 'ëŒ€ê¸°';

        SELECT 'ë§¤ì¹­ ì„±ê³µ' AS result, v_apply_count AS applied_people;

    ELSE
        -- ë§¤ì¹­ ì‹¤íŒ¨ ì²˜ë¦¬
        UPDATE matches
        SET status = 'ë§¤ì¹­ ì‹¤íŒ¨'
        WHERE id = p_match_id
          AND status = 'ëŒ€ê¸°';

        -- í™˜ë¶ˆ ì²˜ë¦¬ (ê²°ì œí•œ ì‚¬ëŒë§Œ)
        UPDATE match_apply
        SET refund_time = NOW()
        WHERE matchesID = p_match_id
          AND payment_time IS NOT NULL;

        SELECT 'ë§¤ì¹­ ì‹¤íŒ¨ - í™˜ë¶ˆ ì™„ë£Œ' AS result, v_apply_count AS applied_people;
    END IF;

END //

DELIMITER ;



```
</details>

</div>
</details>

<details>
<summary><b>pom ì„ ì • ê¸°ëŠ¥ </b></summary>
	
```sql

// ê²½ê¸° ì¢…ë£Œ í›„ ëª¨ë“  í”Œë ˆì´ì–´ íˆ¬í‘œ ì§„í–‰

DELIMITER //

create
    definer = root@localhost procedure POMíˆ¬í‘œ(IN p_applyID bigint, IN p_voterID bigint, IN p_votedID bigint)
BEGIN

    INSERT INTO pom_vote (applyID, voter_memberID, voted_memberID)
    VALUES (p_applyID, p_voterID, p_votedID);

END;

DELIMITER ;


// ê²½ê¸° ì¢…ë£Œ í›„ í•´ë‹¹ ê²½ê¸° pom ì„ ì •

DELIMITER //

CREATE PROCEDURE SelectPOM(
    IN p_matchesID BIGINT
)
BEGIN
    DECLARE v_pom_member BIGINT DEFAULT NULL;

    /*
        1) POM ìµœë‹¤ë“í‘œì ì¡°íšŒ
           - NULL íˆ¬í‘œ ì œì™¸
    */
    SELECT voted_memberID
    INTO v_pom_member
    FROM pom_vote
    WHERE applyID IN (
        SELECT ID
        FROM match_apply
        WHERE matchesID = p_matchesID
    )
    AND voted_memberID IS NOT NULL
    GROUP BY voted_memberID
    ORDER BY COUNT(*) DESC
    LIMIT 1;


    /*
        2) matches í…Œì´ë¸”ì— POM ì—…ë°ì´íŠ¸
    */
    UPDATE matches
    SET POM = v_pom_member
    WHERE ID = p_matchesID;


    /*
        3) POM ì¹´ìš´íŠ¸ ì¦ê°€ (NULL ì´ ì•„ë‹Œ ê²½ìš°ë§Œ)
    */
    IF v_pom_member IS NOT NULL THEN
        UPDATE member
        SET pomCount = pomCount + 1
        WHERE ID = v_pom_member;
    END IF;


    /*
        4) ê²°ê³¼ ì¶œë ¥
    */
    SELECT 
        p_matchesID AS match_id,
        v_pom_member AS selected_pom_member,
        'POM ì„ ì • ë° pomCount ì—…ë°ì´íŠ¸ ì™„ë£Œ' AS message;

END //

DELIMITER ;



```
</details>

</div>
</details>


<details>
<summary><b>ê²°ì œ</b></summary>
	
```sql
// ê²½ê¸° ì„ íƒ í›„ ê²°ì œ ì§„í–‰

DELIMITER //

create
    definer = root@localhost procedure ë§¤ì¹­ì‹ ì²­(IN p_memberID bigint, IN p_matchID bigint, IN p_price int)
BEGIN
    DECLARE v_max_count INT DEFAULT 0;
    DECLARE v_current_count INT DEFAULT 0;

    -- 1) ê²½ê¸° ì •ì›(max_count) ì¡°íšŒ
    SELECT s.max_count
      INTO v_max_count
    FROM matches m
    JOIN stadium s ON s.ID = m.stadiumID
    WHERE m.ID = p_matchID;

    -- 2) í˜„ì¬ í•´ë‹¹ ê²½ê¸° ì‹ ì²­ ì¸ì› ì¡°íšŒ
    SELECT COUNT(*)
      INTO v_current_count
    FROM match_apply
    WHERE matchesID = p_matchID;

    -- 3) ì •ì› ì²´í¬ í›„ ì‹ ì²­ INSERT
    IF v_current_count < v_max_count THEN
        INSERT INTO match_apply (
            memberID,
            matchesID,
            apply_price,
            payment_time
        )
        VALUES (
            p_memberID,
            p_matchID,
            p_price,
            NOW()
        );
    ELSE
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ì •ì›ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.';
    END IF;

END;


//
DELIMITER ;

// ê²½ê¸° ì‹ ì²­ í›„ ê²°ì œ ì·¨ì†Œ

DELIMITER //

CREATE
    DEFINER = `root`@`localhost` PROCEDURE ë§¤ì¹­ì‹ ì²­ì·¨ì†Œ(
        IN p_applyID BIGINT,
        IN p_memberID BIGINT
    )
BEGIN
    DECLARE v_matchID BIGINT;
    DECLARE v_match_datetime DATETIME;
    DECLARE v_now DATETIME;

    SET v_now = NOW();

    -- ì‹ ì²­ ë‚´ì—­ í™•ì¸
    SELECT matchesID
      INTO v_matchID
    FROM match_apply
    WHERE ID = p_applyID
      AND memberID = p_memberID
      AND refund_time IS NULL;

    IF v_matchID IS NULL THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ì‹ ì²­ ë‚´ì—­ì´ ì—†ê±°ë‚˜ ì´ë¯¸ ì·¨ì†Œëœ ë‚´ì—­ì…ë‹ˆë‹¤.';
    END IF;

    -- ê²½ê¸° ì‹œê°„ í™•ì¸
    SELECT TIMESTAMP(m.date, m.time)
      INTO v_match_datetime
    FROM matches m
    WHERE m.ID = v_matchID;

    -- ê²½ê¸° 1ì‹œê°„ ì „ ì´í›„ ì·¨ì†Œ ë¶ˆê°€
    IF v_now >= DATE_SUB(v_match_datetime, INTERVAL 1 HOUR) THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ê²½ê¸° ì‹œì‘ 1ì‹œê°„ ì „ ì´í›„ì—ëŠ” ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
    END IF;

    -- ì‹ ì²­ ì·¨ì†Œ / í™˜ë¶ˆ ì²˜ë¦¬
    UPDATE match_apply
       SET refund_time = v_now,
           status = 'í™˜ë¶ˆ'
     WHERE ID = p_applyID;

    -- matches í…Œì´ë¸” ì¸ì› ê°ì†Œ
    UPDATE matches
       SET member_count = member_count - 1
     WHERE ID = v_matchID
       AND member_count > 0;

END;

//
DELIMITER ;

```
</details>

</div>
</details>


<details>
<summary><b>í™˜ë¶ˆ</b></summary>
	
```sql

// ë§¤ì¹­ ì‹¤íŒ¨ë¡œ ì¸í•œ í™˜ë¶ˆ

DELIMITER //

CREATE PROCEDURE í™˜ë¶ˆìƒíƒœë³€ê²½(
    IN p_matches_id BIGINT
)
BEGIN
    DECLARE v_status VARCHAR(20);

    -- ê²½ê¸° ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
    SELECT status INTO v_status
    FROM matches
    WHERE id = p_matches_id;

    -- ê²½ê¸° ìƒíƒœê°€ 'ì·¨ì†Œ'ì¼ ë•Œë§Œ ì‹¤í–‰
    IF v_status = 'ì·¨ì†Œ' THEN
        -- ê²°ì œ ë‚´ì—­ ìˆëŠ” ì‹ ì²­ë§Œ í™˜ë¶ˆ ì²˜ë¦¬
        UPDATE match_apply
        SET refund_time = NOW(),
            status = 'í™˜ë¶ˆ'
        WHERE matchesID = p_matches_id
          AND payment_time IS NOT NULL;
    END IF;

END //

DELIMITER ;




```
</details>

</div>
</details>

